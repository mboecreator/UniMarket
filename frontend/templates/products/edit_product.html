{% extends 'base.html' %}
{% load static %}

{% block title %}Edit Product - UniMarket{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/seller.css' %}">
{% endblock %}

{% block content %}
<div class="seller-page">
    <div class="seller-container">
        <!-- Header Section -->
        <div class="seller-header">
            <div class="seller-header-content">
                <h1 class="seller-title">
                    <i class="fas fa-edit"></i> Edit Product
                </h1>
                <p class="seller-subtitle">Update your product listing information</p>
            </div>
        </div>

        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'seller_dashboard' %}">Dashboard</a></li>
                <li class="breadcrumb-item"><a href="{% url 'my_products' %}">My Products</a></li>
                <li class="breadcrumb-item active">Edit Product</li>
            </ol>
        </nav>

        <!-- Edit Product Form -->
        <div class="seller-form-card">
            <div class="seller-form-header">
                <h3><i class="fas fa-box"></i> {{ product.title }}</h3>
                <small>Update your product information below</small>
            </div>
            <div class="seller-form-body">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    
                    <!-- Basic Product Information -->
                    <div class="form-section">
                        <h4 class="form-section-title">
                            <i class="fas fa-info-circle"></i> Basic Information
                        </h4>
                        
                        <div class="form-group">
                            <label for="title" class="form-label">Product Title *</label>
                            <input type="text" class="form-control" id="title" name="title" 
                                   value="{{ product.title }}" required maxlength="200"
                                   placeholder="Enter a descriptive title for your product">
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="category" class="form-label">Category *</label>
                                    <select class="form-select" id="category" name="category" required>
                                        <option value="">Select a category</option>
                                        {% for category in categories %}
                                            <option value="{{ category.id }}" 
                                                    {% if product.category.id == category.id %}selected{% endif %}>
                                                {{ category.name }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="price" class="form-label">Price ($) *</label>
                                    <input type="number" class="form-control" id="price" name="price" 
                                           value="{{ product.price }}" required min="0.01" step="0.01"
                                           placeholder="0.00">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="condition" class="form-label">Condition *</label>
                                    <select class="form-select" id="condition" name="condition" required>
                                        <option value="new" {% if product.condition == 'new' %}selected{% endif %}>New</option>
                                        <option value="like_new" {% if product.condition == 'like_new' %}selected{% endif %}>Like New</option>
                                        <option value="good" {% if product.condition == 'good' %}selected{% endif %}>Good</option>
                                        <option value="fair" {% if product.condition == 'fair' %}selected{% endif %}>Fair</option>
                                        <option value="poor" {% if product.condition == 'poor' %}selected{% endif %}>Poor</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="status" class="form-label">Status *</label>
                                    <select class="form-select" id="status" name="status" required>
                                        <option value="available" {% if product.status == 'available' %}selected{% endif %}>Available</option>
                                        <option value="sold" {% if product.status == 'sold' %}selected{% endif %}>Sold</option>
                                        <option value="reserved" {% if product.status == 'reserved' %}selected{% endif %}>Reserved</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="location" class="form-label">Meeting Location *</label>
                            <input type="text" class="form-control" id="location" name="location" 
                                   value="{{ product.location }}" required maxlength="200"
                                   placeholder="e.g., Library entrance, Student Center">
                        </div>

                        <div class="form-group">
                            <label for="description" class="form-label">Description *</label>
                            <textarea class="form-control" id="description" name="description" rows="4" required
                                      placeholder="Provide detailed information about your product, including any defects, usage history, etc.">{{ product.description }}</textarea>
                        </div>
                    </div>

                    <!-- Current Image Display -->
                    {% if product.image %}
                    <div class="form-section">
                        <h4 class="form-section-title">
                            <i class="fas fa-image"></i> Current Image
                        </h4>
                        <div style="margin-bottom: 20px;">
                            <img src="{{ product.image.url }}" class="image-preview" alt="Current product image" style="max-width: 300px;">
                        </div>
                    </div>
                    {% endif %}

                    <!-- Images Section -->
                    <div class="form-section">
                        <h4 class="form-section-title">
                            <i class="fas fa-camera"></i> Update Images
                        </h4>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            Upload new images to replace the current ones (optional).
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="image" class="form-label">Main Product Image</label>
                                    <div class="file-upload-area" onclick="document.getElementById('image').click()">
                                        <div class="file-upload-icon">
                                            <i class="fas fa-cloud-upload-alt"></i>
                                        </div>
                                        <div class="file-upload-text">Click to upload new main image</div>
                                        <div class="file-upload-hint">JPG, PNG, GIF up to 10MB</div>
                                    </div>
                                    <input type="file" class="form-control" id="image" name="image" accept="image/*" style="display: none;">
                                    <div id="main-image-preview" class="mt-2"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="additional_images" class="form-label">Additional Images</label>
                                    <div class="file-upload-area" onclick="document.getElementById('additional_images').click()">
                                        <div class="file-upload-icon">
                                            <i class="fas fa-images"></i>
                                        </div>
                                        <div class="file-upload-text">Click to upload more images</div>
                                        <div class="file-upload-hint">Up to 5 additional photos</div>
                                    </div>
                                    <input type="file" class="form-control" id="additional_images" name="additional_images" 
                                           accept="image/*" multiple style="display: none;">
                                    <div id="additional-images-preview" class="additional-images mt-2"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Contact Information Section -->
                    <div class="form-section">
                        <h4 class="form-section-title">
                            <i class="fas fa-address-book"></i> Contact Information
                        </h4>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="seller_phone" class="form-label">Contact Phone</label>
                                    <input type="tel" class="form-control" id="seller_phone" name="seller_phone" 
                                           value="{{ product.seller_phone }}" maxlength="15" placeholder="Your phone number">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="seller_email" class="form-label">Contact Email</label>
                                    <input type="email" class="form-control" id="seller_email" name="seller_email" 
                                           value="{{ product.seller_email }}" placeholder="Your email address">
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="preferred_contact_method" class="form-label">Preferred Contact Method</label>
                            <select class="form-select" id="preferred_contact_method" name="preferred_contact_method">
                                <option value="message" {% if product.preferred_contact_method == 'message' %}selected{% endif %}>In-app Message</option>
                                <option value="email" {% if product.preferred_contact_method == 'email' %}selected{% endif %}>Email</option>
                                <option value="phone" {% if product.preferred_contact_method == 'phone' %}selected{% endif %}>Phone</option>
                                <option value="any" {% if product.preferred_contact_method == 'any' %}selected{% endif %}>Any Method</option>
                            </select>
                        </div>
                    </div>

                    <!-- Submit Buttons -->
                    <div class="form-actions" style="display: flex; justify-content: space-between; align-items: center; margin-top: 30px;">
                        <a href="{% url 'my_products' %}" class="btn-seller-secondary">
                            <i class="fas fa-arrow-left"></i> Back to My Products
                        </a>
                        <button type="submit" class="btn-seller-primary" id="submitBtn">
                            <i class="fas fa-save"></i> Update Product
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Reuse the same JavaScript from add_product.html
document.addEventListener('DOMContentLoaded', function() {
    // Main image upload
    const mainImageInput = document.getElementById('image');
    const mainImagePreview = document.getElementById('main-image-preview');
    const mainUploadArea = document.querySelector('.file-upload-area');
    
    mainImageInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                mainImagePreview.innerHTML = `
                    <img src="${e.target.result}" class="image-preview" alt="New product image">
                `;
                mainUploadArea.classList.add('has-file');
                mainUploadArea.innerHTML = `
                    <div class="file-upload-icon">
                        <i class="fas fa-check-circle" style="color: var(--success-color);"></i>
                    </div>
                    <div class="file-upload-text">New image selected!</div>
                    <div class="file-upload-hint">Click to change image</div>
                `;
            };
            reader.readAsDataURL(file);
        }
    });
    
    // Form submission with loading state
    const form = document.querySelector('form');
    const submitBtn = document.getElementById('submitBtn');
    
    form.addEventListener('submit', function(e) {
        submitBtn.innerHTML = '<span class="spinner"></span> Updating Product...';
        submitBtn.disabled = true;
        submitBtn.classList.add('loading');
    });
});
</script>
{% endblock %}